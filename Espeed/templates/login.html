<!-- 基础空白文档 -->
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <title>注册</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
    <script type="text/javascript" src="../static/lib/index.min.js"></script>          <!-- 解决移动端适配 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link rel="stylesheet" href="../static/css/style201805262115.css">
</head>

<body class="page">
<div class="login">
    <!-- 主体内容 -->
    <section class="main">
        <h1>e我速工</h1>
        <form action="/register/" method="post" id="loginForm">
            <div class="registerBox">
                <h4>Hi,欢迎登陆</h4>
                <div class="phoneBox">
                    <input id="phoneNum" type="number" name="phoneNum" onkeyup="checkPhoneNum(this)" value="" placeholder="请输入手机号码" >
                </div>
                <div class="codeBox">
                    <input id="signCode" type="number" onkeyup="checksignCode(this)" name="signCode" value="" placeholder="请输入验证码" >
                    <input id="openid" type="hidden" value="{{ openid }}" name="openid">
                    <input type="button"  class="weui-btn weui-btn_primary weui-btn_mini validCodeBtn" onclick="sendMessage()" value="获取验证码" />
                </div>
            </div>
            <p id="tips"></p>
            <div class="submitBox">
                <button type="submit" id="loginBtn" class="weui-btn weui-btn_primary">登录</button>
                <p class="info">未注册的手机号登录时将自动注册且<br/>代表您已同意
                    <a id="policy" href="javascript:;">用户协议</a>
                </p>
            </div>
        </form>
    </section>
</div>

<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script type="text/javascript" src="../static/lib/jquerySession.js"></script>
<script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
<script>

    $(function () {
        // 开启fastclick功能
        FastClick.attach(document.body);

        $('#policy').click(function () {
            var $policyTxt = "用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容用户协议内容";
            $.alert($policyTxt, "用户协议");
        })
    });

    alert("初始的openid:"+ $("#openid").val());
    //注册验证
    var loginBtn = document.getElementById("loginBtn");
    var tips = document.getElementById("tips");
    loginBtn.onclick = function () {
        var phoneVal = document.getElementById('phoneNum').value;
        window.localStorage.setItem("phoneNum",phoneVal);
        var signCodeVal = document.getElementById('signCode').value;
        if(phoneVal == "" ){
            tips.innerHTML = "请输入手机号";
            return false;
        }
        if(signCodeVal == ""){
            tips.innerHTML = "请输入验证码";
            return false;
        }
    };

    //字数验证
    function checkPhoneNum(obj) {
        tips.innerHTML = "";
        var phoneNum = obj.value;
        if(phoneNum.length > 11){
            obj.value = phoneNum.slice(0,11);
            tips.innerHTML = "只能输入11位手机号";
        }
    }
    function checksignCode(obj) {
        tips.innerHTML = "";
        var phoneNum = obj.value;
        if(phoneNum.length > 4){
            obj.value = phoneNum.slice(0,4);
            tips.innerHTML = "只能输入11位手机号";
        }
    }

    //获取验证码
    var InterValObj; //timer变量，控制时间
    var count = 60; //间隔函数，1秒执行
    var curCount;//当前剩余秒数
    function sendMessage() {
        window.clearInterval(InterValObj);//停止计时器
        curCount = count;
        var phoneNum=$("#phoneNum").val();//手机号码
        if(phoneNum != ""){
            //设置button效果，开始计时
            $(".validCodeBtn").attr("disabled", "true");
            $(".validCodeBtn").removeClass("weui-btn_primary");
            $(".validCodeBtn").val(curCount + "秒后重新获取");
            InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
            //向后台发送处理数据
            $.ajax({
                async: true,
                url: '/verify_code/',
                dataType: "json",
                type: "post",
                data: {
                    openId: $("#openid").val(),
//                  openId: "oT69X1PX1jG6Ojhij3tQVOGSnWzQ",
                    phoneNum:$("#phoneNum").val()
                },
                success: function (res) {
                    var res = {"Message":"123465invalid mobile number","RequestId":"3D9745E3-5E87-4B7D-9A7A-EC89C66DBA73","Code":"isv.MOBILE_NUMBER_ILLEGAL"}
                    if(res.Code = "isv.MOBILE_NUMBER_ILLEGAL") {
                        tips.innerHTML = "您输入的手机号有误";
                    }
                },
                error: function(error) {
                    console.log(error.readyState, error.statusText);
                }
            });
        }else{
            tips.innerHTML = "手机号码不能为空！";
        }
    }

    //倒计时timer处理函数
    function SetRemainTime() {
        if (curCount == 0) {
            window.clearInterval(InterValObj);//停止计时器
            $(".validCodeBtn").removeAttr("disabled");//启用按钮
            $(".validCodeBtn").addClass("weui-btn_primary");
            $(".validCodeBtn").val("重新获取验证码");
        }
        else {
            curCount--;
            $(".validCodeBtn").val(curCount + "秒后重新获取");
        }
    }
</script>
</body>
</html>
