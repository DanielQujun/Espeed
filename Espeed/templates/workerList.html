<!-- 基础空白文档 -->
<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="utf-8">
  <title>列表页</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
  <script type="text/javascript" src="../static/lib/index.min.js"></script>          <!-- 解决移动端适配 -->
  <link rel="stylesheet" href="../static/css/weui.css">
  <link rel="stylesheet" href="../static/iconfont/iconfont.css">
  <link rel="stylesheet" href="../static/css/jquery-weui.css">
  <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>
  <div class="workerList">
    <!-- 头部 -->

    <header>
        <div class="weui-navbar">
            <div class="weui-navbar__item weui_bar__item_on">
                <span id="distanceFilter">离我最近</span>
            </div>
            <div class="weui-navbar__item">
                最新上线
            </div>
          </div>
    </header>

    <!-- 主体内容 -->
    <section class="main">
        <ul class="listCon">

        </ul>
    </section>

    <!-- 底部 -->
    <footer>
        <a href="javascript:;"><button  class="smallBtn Relocate"><i class="iconfont icon-shuaxin"></i></button></a>
        <a href="javascript:;"><button  class="bigBtn cancel"><i class="iconfont icon-quxiao"></i>取消发布</button></a>
        <a href="userCenter.html"><button  class="smallBtn"><i class="iconfont icon-wode"></i></button></a>

    </footer>
  </div>

  <script type="text/javascript" src="../static/lib/jquery-2.1.4.js"></script>
  <script type="text/javascript" src="../static/js/jquery-weui.min.js"></script>        <!-- 为将来做拓展，引入Jquery weui -->
  <script type="text/javascript" src="../static/lib/fastclick.js"></script>            <!-- 解决点击屏幕延迟，需要测试是否有效，无效再删除 -->
  <script>
    // 开启fastclick功能
    $(function() {
        FastClick.attach(document.body);



        loadData();

        $('.cancel').click(function () {
            $.confirm("取消后，您的信息将对其他人不可见","确认取消", function() {
                //点击确认后跳转到列表页
                location.href = "jobs"
                //（TODO:清除session)


            }, function() {
                //点击取消
                return false;
            });
        })

    });


    //获取位置信息排序列表,接口未定义（TODO: 定义排序接口）
    $(function () {
        $("#distanceFilter").click(function () {
            $.get(
                "/try/ajax/demo_test.php",
                function(data,status){
                alert("数据: " + data + "\n状态: " + status);
            });

        });

    });



    function loadData() {
        //时间戳
        var $timeStamp = $.now();
        //TODO:需要从session中获取,并且写出转换函数
        var $tags = [1,3];
        var $latitude = 116.331398;
        var $longitude = 39.897445;

      $.ajax({
          url:"workerList.json",
          dataType:"json",
          type:"post",
          data:{
              "openId":123456,
              "time":$timeStamp,
              "tag":$tags,
              "latitude": $latitude,
              "longitude":$longitude,
              "page":1
          },
          success: function (data) {
            showData(data.listData);

          },
          error: function (error) {
              console.log(error.readyState, error.statusText);

          }
          });
    };


    function showData(data) {

        $.each(data,function (key,val) {

            // 造工种标签html
            var $tags = "";
            //循环工种数组，取出对应的title
            $.each(val.tag,function (key, tagval) {
                //工种数据
                var $jobList = [
                    {
                        title: "土建木工",
                        value: 1
                    },{
                        title: "装修木工",
                        value: 2
                    },{
                        title: "铺砖工",
                        value: 3
                    },{
                        title: "铁工",
                        value: 4
                    },{
                        title: "空调工",
                        value: 5
                    },{
                        title: "贴墙纸工",
                        value: 6
                    },{
                        title: "刮腻子工",
                        value: 7
                    },{
                        title: "仿古油漆工",
                        value: 8
                    },{
                        title: "油性油漆工",
                        value: 9
                    },{
                        title: "彩绘工",
                        value: 10
                    },{
                        title: "高空作业工",
                        value: 11
                    },{
                        title: "铝焊工",
                        value: 12
                    },{
                        title: "不锈钢焊工",
                        value: 13
                    },{
                        title: "特殊焊工",
                        value: 14
                    },{
                        title: "绿化工",
                        value: 15
                    },{
                        title: "汽修工",
                        value: 16
                    },{
                        title: "铲车/钩机",
                        value: 17
                    },{
                        title: "压路机/泥头车",
                        value: 18
                    },{
                        title: "吊车货车司机",
                        value: 19
                    },{
                        title: "高压电工",
                        value: 20
                    },{
                        title: "低压电工",
                        value: 21
                    },{
                        title: "弱电工",
                        value: 22
                    },{
                        title: "临时杂工",
                        value: 23
                    },{
                        title: "网络布线维护",
                        value: 24
                    },{
                        title: "雕刻师傅",
                        value: 25
                    },{
                        title: "高空作业工",
                        value: 26
                    },{
                        title: "水泥塑石工",
                        value: 27
                    }
                ];

                //将工种与title对应上
                $.each($jobList,function (key, job) {

                    if(job.value == tagval) {
                        $tags += '<span class="tag">'+ job.title +'</span>';
                    }
                });
            });


            //拼大字符串
            var str = "";

                str += '<li class="listItem flex">' +
                    '<div class="portraitBox">' +
                    '<img src="' + val.portraitUrl + '" >' +
                    '<p>' + val.username + '</p>' +
                    '</div>' +
                    '<div class="infoBox flex">' +
                    '<div class="list_hd flex">' +
                    '<div class="tagBox">'+ $tags +'</div>' +
                    '<div class="star star'+ val.star +'"></div>' +
                    '</div>' +
                    '<div class="list_bd flex">' +
                    '<span class="distance">距您：'+ formatDistance(val.distance) + '</span>' +
                    '<p class="publishedTime">发布于：'+ val.pubTime + '</p>' +
                    '</div>' +
                    '<div class="list_ft flex">' +
                    '<a href="#" class="rate weui-btn weui-btn_mini weui-btn_plain-primary">评价</a>' +
                    '<a href="#" class="check weui-btn weui-btn_mini weui-btn_primary">查看电话号码</a>' +
                    '</div>' +
                    '</div>' +
                    '</li>';

                $('.listCon').append(str);

        })

        function formatDistance(val) {
            if(val > 1000) {
                return (val/1000).toFixed(2) + ' km';
            } else {
                return parseInt(val) + ' m';
            }
        }

        function formatTime(val) {


        }



    }

  </script>
</body>

</html>