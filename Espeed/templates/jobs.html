<!-- 基础空白文档 -->
<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="utf-8">
  <title>选择工种</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
  <script type="text/javascript" src="../static/lib/index.min.js"></script>          <!-- 解决移动端适配 -->
  <link rel="stylesheet" href="../static/css/weui.css">
  <link rel="stylesheet" href="../static/iconfont/iconfont.css">
  <link rel="stylesheet" href="../static/css/jquery-weui.css">
  <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>
  <div class="jobs">
    <header>
      <i class="iconfont icon-location"></i><span>深圳市福田区新民路24号</span>
    </header>
    <!-- 主体内容 -->
    <section class="main">
      <div class="jobsBox">
        <div class="jobs_hd">请选择您需要的工种，最多两个</div>
        <div class="jobs_bd flex">
        </div>
      </div>
    </section>

    <!-- 底部 -->
    <footer>
      <a href="javascript:;"><button  class="smallBtn Relocate"><i class="iconfont icon-dingwei"></i></button></a>
      <a href="javascript:;"><button  class="bigBtn"><i class="iconfont icon-jia1"></i>立即发布</button></a>
      <a href="/userCenter.html"><button  class="smallBtn"><i class="iconfont icon-wode"></i></button></a>
    </footer>
  </div>

  <script type="text/javascript" src="../static/lib/jquery-2.1.4.js"></script>
  <script type="text/javascript" src="../static/lib/jquerySession.js"></script>
  <script type="text/javascript" src="../static/js/jquery-weui.min.js"></script>        <!-- 为将来做拓展，引入Jquery weui -->
  <script type="text/javascript" src="../static/lib/fastclick.js"></script>            <!-- 解决点击屏幕延迟，需要测试是否有效，无效再删除 -->
  <script>

    $(function() {
        // 开启fastclick功能
        FastClick.attach(document.body);
        //显示location信息
        locationInit();

        //模拟session数据
        $.session.set('role',"1");
        var $choosedJob = [];
        $.session.set('myJob',$choosedJob);

        //工种数据
        var $jobList = [
            {
                title: "土建木工",
                value: 1
            },{
                title: "装修木工",
                value: 2
            },{
                title: "铺砖工",
                value: 3
            },{
                title: "铁工",
                value: 4
            },{
                title: "空调工",
                value: 5
            },{
                title: "贴墙纸工",
                value: 6
            },{
                title: "刮腻子工",
                value: 7
            },{
                title: "仿古油漆工",
                value: 8
            },{
                title: "油性油漆工",
                value: 9
            },{
                title: "彩绘工",
                value: 10
            },{
                title: "高空作业工",
                value: 11
            },{
                title: "铝焊工",
                value: 12
            },{
                title: "不锈钢焊工",
                value: 13
            },{
                title: "特殊焊工",
                value: 14
            },{
                title: "绿化工",
                value: 15
            },{
                title: "汽修工",
                value: 16
            },{
                title: "铲车/钩机",
                value: 17
            },{
                title: "压路机/泥头车",
                value: 18
            },{
                title: "吊车货车司机",
                value: 19
            },{
                title: "高压电工",
                value: 20
            },{
                title: "低压电工",
                value: 21
            },{
                title: "弱电工",
                value: 22
            },{
                title: "临时杂工",
                value: 23
            },{
                title: "网络布线维护",
                value: 24
            },{
                title: "雕刻师傅",
                value: 25
            },{
                title: "高空作业工",
                value: 26
            },{
                title: "水泥塑石工",
                value: 27
            }
        ]

        //渲染工种按钮
        $.each($jobList,function (key,val) {
            var str = "";
            str += '<button class="job " value="'+ val.value + '">' + val.title +'</button>'

            $('.jobs_bd').append(str);
        })


        if($.session.get('myJob').length !== 0) {
            //页面初始化读取session 判断有几个按钮被选中
            var $activeArr = $.session.get('myJob').split(',');
            $.each($activeArr,function (key,val) {
                $.each($('.job'),function () {
                    //如果session中已标注的岗位与button组中对应的按钮value值对应上的话，添加active class
                    if($(this).attr("value") == val ) {
                        $(this).addClass('active');
                        $('.bigBtn').addClass('publish');
                        $('.bigBtn .icon-jia1').removeClass('icon-jia1').addClass('icon-gouxuan');
                    }
                });

            });
        }


        $('.job').click(function () {
            /*
            * 1、判断session中有没有数据，如果为空，push一条数据进去，增加active class
            * 2、如果有一条数据，先判断点击的是不是原来的那条，如果是，删除该条目，移除active class；如果不是，push一条
            * 3、如果有两条，先判断点击的是不是原来的两条，如果是，删除该条目，移除class
            *
            * */

            var $jobArr = [];
            if($.session.get('myJob').length == 0) {
                $jobArr.push($(this).val());
                $.session.set('myJob',$jobArr);
                $(this).addClass('active');
            } else if($.session.get('myJob').split(',').length == 1) {
                var $checked = $('.job.active');
//                console.log($(this).val());
                if($(this).val() == $checked.eq(0).val() ){
                    $jobArr.splice(0,1);
                    $.session.set('myJob',$jobArr);
                    $(this).removeClass('active');
                } else {
                    $jobArr = $.session.get('myJob').split(',');
                    $jobArr.push($(this).val());
                    $.session.set('myJob',$jobArr);
                    $(this).addClass('active');
                }
            } else if ($.session.get('myJob').split(',').length == 2){
//                 var $checkedArr = $.session.get('myJob').split(',');
//                $.each($checkedArr,function (key, val) {
//                    //通过循环的val值来生成一个属性选择器参数，来选择对应的button
//                    var $attribute = '.job[value="'+val+'"]';
//                    $($attribute).addClass('active');
////                    $jobArr.push($($attribute).val());
////                    $.session.set('myJob',$jobArr);
//                });
//
//                $(this).removeClass('active');

//                这里的逻辑有问题，待修复
            }


            //写入session



            //判断是否有工种被选中，操作发布按钮的状态
            var $myJobArr = $.session.get('myJob').split(",");
            if ( $myJobArr.length > 0) {
                //seesion 不为空时激活发布按钮
                $('.bigBtn').addClass('publish');
                $('.bigBtn .icon-jia1').removeClass('icon-jia1').addClass('icon-gouxuan');
            } else {
                //seesion 为空时切换回按钮的置黑状态
                $('.bigBtn').removeClass('publish');
                $('.bigBtn .icon-gouxuan').removeClass('icon-gouxuan').addClass('icon-jia1');
            }
        });


        //如果没有publish类（没有选工种），则不能发布，弹窗提示
        $('.bigBtn').click(function () {
            if($('.bigBtn.publish').length == 1){
                //至少选了1个工种
                $.confirm("发布后，您的消息将被各位老板看见，您可能会接到老板的招工电话，请保持手机畅通","确认发布", function() {
                    //点击确认后跳转到列表页
                    location.href = "/workerList"
                }, function() {
                    //点击取消
                    return false;
                });
            } else {
                //没有选工种
                $.alert('请先选择工种然后再发布','温馨提示')
            }
        });



        //手动重新定位
        $('.Relocate').click(function () {
            locationInit();
        })

        function locationInit() {
            //wx.location();
            console.log('这里需要调用微信js-sdk 的location接口')
        }


    });
  </script>
</body>

</html>