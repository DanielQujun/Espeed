<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="utf-8">
    <title>选择工种</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
    <script type="text/javascript" src="../static/lib/index.min.js"></script>          <!-- 解决移动端适配 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
    <link rel="stylesheet" href="../static/iconfont/iconfont.css">
    <link rel="stylesheet" href="../static/css/style201805282212.css">
</head>

<body class="page">
<div class="jobs">
    <header>
        <i class="iconfont icon-location"></i><span id="location">获取位置信息中...</span>
    </header>
    <!-- 主体内容 -->
    <section class="main">
        <div class="jobsBox">
            <div class="jobs_hd">请选择您需要的工种，最多两个</div>
            <div class="jobs_bd flex" id="inputsParent">
            </div>
        </div>
        <!--<input type="hidden" id="jobList" value="{{ jobList|safe }}">-->
        <!--<div class="hiddenData" style="width: 100%;height: 1px; overflow:hidden;">{{ jobList|safe }}</div>       &lt;!&ndash;需要隐藏起来&ndash;&gt;-->
        <div class="hiddenData" style="">
            [{"value": 1, "title": "\u571f\u5efa\u6728\u5de5"}, {"value": 2, "title": "\u88c5\u4fee\u6728\u5de5"}, {"value": 3, "title": "\u94fa\u7816\u5de5"}, {"value": 4, "title": "\u94c1\u5de5"}, {"value": 5, "title": "\u7a7a\u8c03\u5de5"}, {"value": 6, "title": "\u8d34\u5899\u7eb8\u5de5"}, {"value": 7, "title": "\u522e\u817b\u5b50\u5de5"}, {"value": 8, "title": "\u4eff\u53e4\u6cb9\u6f06\u5de5"}, {"value": 9, "title": "\u6cb9\u6027\u6cb9\u6f06\u5de5"}, {"value": 10, "title": "\u5f69\u7ed8\u5de5"}, {"value": 11, "title": "\u9ad8\u7a7a\u4f5c\u4e1a\u5de5"}, {"value": 12, "title": "\u94dd\u710a\u5de5"}, {"value": 13, "title": "\u4e0d\u9508\u94a2\u710a\u5de5"}, {"value": 14, "title": "\u7279\u6b8a\u710a\u5de5"}, {"value": 15, "title": "\u7eff\u5316\u5de5"}, {"value": 16, "title": "\u6c7d\u4fee\u5de5"}, {"value": 17, "title": "\u94f2\u8f66/\u94a9\u673a"}, {"value": 18, "title": "\u538b\u8def\u673a/\u6ce5\u5934\u8f66"}, {"value": 19, "title": "\u540a\u8f66\u8d27\u8f66\u53f8\u673a"}, {"value": 20, "title": "\u9ad8\u538b\u7535\u5de5"}, {"value": 21, "title": "\u4f4e\u538b\u7535\u5de5"}, {"value": 22, "title": "\u5f31\u7535\u5de5"}, {"value": 23, "title": "\u4e34\u65f6\u6742\u5de5"}, {"value": 24, "title": "\u7f51\u7edc\u5e03\u7ebf\u7ef4\u62a4"}, {"value": 25, "title": "\u96d5\u523b\u5e08\u5085"}, {"value": 26, "title": "\u9ad8\u7a7a\u4f5c\u4e1a\u5de5"}, {"value": 27, "title": "\u6c34\u6ce5\u5851\u77f3\u5de5"}]
        </div>
    </section>

    <!-- 底部 -->
    <footer>
        <!--<a href="javascript:;">
            <button class="smallBtn relocate"><i class="iconfont icon-dingwei"></i></button>
        </a>-->
        <button class="bigBtn"><i class="iconfont icon-jia1"></i>立即发布</button>
        <button class="smallBtn" onclick="goUrl('userCenter')"><i class="iconfont icon-wode"></i>个人中心</button>
    </footer>
</div>

<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script type="text/javascript" src="../static/lib/jquerySession.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>        <!-- 引入微信js sdk -->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=BVbS3AVAs8iNor6NGxKfc1gG5OcqTxBu"></script>
<script type="text/javascript" src="../static/js/utility.js"></script>
<script type="text/javascript" src="../static/lib/fastclick.js"></script>            <!-- 解决点击屏幕延迟，需要测试是否有效，无效再删除 -->
<script>

    $(function () {
        FastClick.attach(document.body);

        //调用微信sdk配置
        wx.config({
            //debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: "{{ appid }}", // 必填，企业号的唯一标识，此处填写企业号corpid
            timestamp: "{{timestamp}}", // 必填，生成签名的时间戳
            nonceStr: "{{ nonceStr }}", // 必填，生成签名的随机串
            signature: "{{ signature }}",// 必填，签名，见附录1
            jsApiList: [
                'getLocation'
            ]
        });
        //通过error接口处理失败验证
        wx.error(function (res) {
            $.scojs_message(res.errMsg, $.scojs_message.TYPE_ERROR);
        });


        //配置成功后，调用接口
        wx.ready(function () {

            //调用location函数，将位置转化为地址，并写入session；
            lacation();

            $('.relocate').click(function () {
                lacation();
                $.toast("重新定位中...", "text");
            })

        });

        //工种数据
//        var $jobList =$("#jobList").val();
//            var $jobList ={{ jobList|safe }};

        var $jobList =$(".hiddenData").html();
        $jobListObj = eval('('+ $jobList +')');
        console.log($jobListObj);




        //渲染工种按钮
        $.each($jobListObj, function (key, val) {
            var str = "";
            str += '<input id="job' + val.value + '" type="checkbox" onclick="check_count(this)" value="' + val.title + '" /><label for="job' + val.value + '">' + val.title + '</label>'
            $('.jobs_bd').append(str);
        });
    });

    var p_tag, inputs, selectInputs = [];
    $(function () {
        //工种选择初始化，页面加载时判断有几个input被选中，加入数组中
        p_tag = document.getElementById("inputsParent");
        inputs = p_tag.getElementsByTagName("input");
        for (var i = 0; i < inputs.length; i++) {
            if (inputs[i].checked == true) selectInputs.push(inputs[i]);
        };
    });

    function check_count(th) {
        if (th.checked == true) {
            selectInputs.push(th);
            if (selectInputs.length > 2) {
                selectInputs[0].checked = false;
                selectInputs.shift();
            }
        } else {
            if (selectInputs.length > 1) {
                for (var i = 0; i < selectInputs.length; i++) {
                    if (th == selectInputs[i]) selectInputs.splice(i, 1);
                }
            } else {
                th.checked = true;
                return false;
            }
        }

        //激活发布按钮，else暂时没有用
        if (selectInputs.length > 0) {
            $('.bigBtn').addClass('publish');
            $('.bigBtn .icon-jia1').removeClass('icon-jia1').addClass('icon-gouxuan');
        } else {
            $('.bigBtn').removeClass('publish');
            $('.bigBtn .icon-gouxuan').removeClass('icon-gouxuan').addClass('icon-jia1');
        }
    }

    //如果没有publish类（没有选工种），则不能发布，弹窗提示
    $('.bigBtn').click(function () {
        //将选择的工种数值写入session
        var $jobVal = [];
        for (var i = 0; i < selectInputs.length; i++) {
            $jobVal.push(selectInputs[i].value);
        }
        $.session.set("myJob", $jobVal);

        if ($('.bigBtn.publish').length == 1) {
            //至少选了1个工种
            $.confirm("发布后，您的消息将被各位老板看见，您可能会接到老板的招工电话，请保持手机畅通", "确认发布", function () {
                //通过ajax将session中发布参数传到后台
                $.ajax({
                    url: "/jobs/",
                    type: "post",
                    data: {
                        online: true,
                        openid: window.localStorage.getItem("openid"),
//                        openid: "oT69X1PX1jG6Ojhij3tQVOGSnWzQ",
                        tag: $.session.get('myJob'),
                        latitude: $.session.get('latitude'),
                        longitude: $.session.get('longitude'),
                    },
                    success: function () {
                        location.href = "/workerList/?openid="+window.localStorage.getItem("openid");
//                        location.href = "/workerList/?openid=oT69X1PX1jG6Ojhij3tQVOGSnWzQ";
                    }
                })

            }, function () {
                return false;
            });
        } else {
            //没有选工种
            $.alert('请至少选择一个工种，然后再进行发布', '温馨提示')
        }
    });

    //创建百度地图对象
    var myGeo = new BMap.Geocoder();

    /*$(".smallBtn").click(function () {
        goUrl("userCenter");
    })*/

</script>
</body>

</html>